clc;clear; restoredefaultpath;close all
[Maps,M4] = Calibration_2DKIII(3,1,5);
X = 0; 
for iO = 0.31:-Maps.Maps.stepsize:-0.31
    Y = 0; X = X+1;
    for iV = 0.31:-Maps.Maps.stepsize:-0.31
        Y = Y+1;
    Maps.xo = [iO;-0.99];	Maps.yo = [iV;iV];
    x(X,Y) = iO;        y(X,Y) = iV;
    try
        [~,J,KI,KII,KIII] = Abaqus_2D_KIII(Maps,M4);
        rmdir('Abaqus Output','s');
    catch
        J.true = NaN;	J.div = NaN;    J.K.true = NaN;	J.K.div = NaN;
        KI.true = NaN;  KI.div = NaN;   KII.true = NaN;	KII.div = NaN;
        KIII.true = NaN;KIII.div = NaN;
    end
    j(X,Y) = J.true;        je(X,Y) = J.div;
    jk(X,Y) = J.K.true;     jke(X,Y) = J.K.div;
    kI(X,Y) = KI.true;    	kIe(X,Y) = KI.div;
    kII(X,Y) = KII.true;  	kIIe(X,Y) = KII.div;
    kIII(X,Y) = KIII.true; 	kIIIe(X,Y) = KIII.div;
    clear J KI KII KIII
    end
end
save('A:\OneDrive - Nexus365\GitHub\Abaqus_2D_KIII\Error.mat');

%%
% clc;clear;close all
set(0,'defaultAxesFontSize',20);       set(0,'DefaultLineMarkerSize',20)
load('A:\OneDrive - Nexus365\GitHub\Abaqus_2D_KIII\Error.mat');
Jtrue = 1571.3;
J = 1-diag(j/j(8,8));    Je = diag(je/j(8,8));
JK = 1-diag(jk/jk(8,8));    JKe = diag(jke/jk(8,8));
KI = 1-diag(kI/kI(8,8));    KIe = diag(kIe/kI(8,8));
KII = 1-diag(kII/kII(8,8));    KIIe = diag(kIIe/kII(8,8));
KIII = 1-diag(kIII/kIII(8,8));    KIIIe = diag(kIIIe/kIII(8,8));
close all
fig=figure;set(fig,'defaultAxesColorOrder',[[0 0 0]; [1 0 0]]);
yyaxis left;    hold on;
errorbar(diag(x),KI(:),KIe(:),'--.k','LineWidth',2,'MarkerFaceColor','k');
errorbar(diag(x),KII(:),KIIe(:),'--.b','MarkerEdgeColor','b','LineWidth',2);
errorbar(diag(x),KIII(:),KIIIe(:),'--.c','LineWidth',2,'MarkerFaceColor','k');
ylabel('%K_{Err}'); hold off
 ylim([-1.5 1.5]);    
yyaxis right;
errorbar(diag(x),J(:),Je(:),'--.r','LineWidth',2,'MarkerFaceColor','r');
hold on; line([0,0],[-30,-30
ylabel('%J_{Err}');        ylim([-30 30]);
xlabel('Distance from the tip');
[~,objh]=legend('K_{I}','K_{II}','K_{III}','J_{integral}','location','best');
objhl = findobj(objh, 'type', 'line'); %// objects of legend of type line
set(objhl, 'Markersize', 25); box off
set(gcf,'WindowStyle','normal');
set(gcf,'position',[191 221 632 638]);%  xlim([-0.3 0.3])
box off; 
saveas(gcf, 'Error_diag.fig');
saveas(gcf, 'Error_diag.tif');    close

%%
set(0,'defaultAxesFontSize',23); 	set(0,'DefaultLineMarkerSize',20)
subplot(2,2,1);contourf(x-0.02,y-0.02,(j-j(8,8))/j(8,8),'LineStyle','none');
c=colorbar; axis image; c.Label.String = '%J_{Err}';
subplot(2,2,2);contourf(x-0.02,y-0.02,(kI-kI(8,8))/kI(8,8),'LineStyle','none');
c=colorbar; axis image; c.Label.String = '%KI_{Err}';axis off
subplot(2,2,3);contourf(x-0.02,y-0.02,(kII-kII(8,8))/kII(8,8),'LineStyle','none');
c=colorbar; axis image; c.Label.String = '%KII_{Err}';axis off
subplot(2,2,4);contourf(x-0.02,y-0.02,(kIII-kIII(8,8))/kIII(8,8),'LineStyle','none');
c=colorbar; axis image; c.Label.String = '%KIII_{Err}';axis off
set(gcf,'position',[680 157 1138 821]);brighten(0.5);brighten(0.5);colormap jet
saveas(gcf, 'Error.fig');
saveas(gcf, 'Error.tif');    close

